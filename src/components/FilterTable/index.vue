<template>
  <div class="filter-table">
    <m-filter
      ref="MFilter"
      :filter-list="filterList"
      :filter-grade="filterGrade"
      :filter-params="filterParams"
      :table-list="tableList"
      :add-btn="addBtn"
      :export-btn="exportBtn"
      @search="searchFun"
      @clearOut="clearFun"
      @export="exportBack"
      @setTable="setTable"
      @addFun="addBack"
      @tableHeight="tableHeight"
    />
    <m-table
      ref="MTable"
      :table-list="tableList"
      :url="url"
      :data-type="dataType"
      :row-key="rowKey"
      :opreat="opreat"
      :opreat-width="opreatWidth"
      :back-params="BackParams"
      :local-name="localName"
      :fetch-type="fetchType"
      :fetch-error="fetchError"
      :table-params="tableParams"
      :out-params="outParams"
      :default-page-size="defaultPageSize"
      :highlight-current-row="highlightCurrentRow"
      @tableClick="tableClick"
      @selectChange="selectChange"
      @currentChange="currentChange"
    />
  </div>
</template>

<script lang="ts">
import { Prop, Emit, Vue, Component } from 'vue-property-decorator';
import { FilterFormList, tableList, Opreat } from '@/interface/index';
import MFilter from './MFilter';
import MTable from './MTable';

@Component({
  components: {
  "m-filter": MFilter,
  "m-table": MTable
  }
  })
export default class FilterTable extends Vue {
  // 筛选表单生成参数
  @Prop() private filterList!: FilterFormList[];
  // 筛选表单高级生成参数
  @Prop() private filterGrade!: FilterFormList[];
  // 筛选表单存储数据参数
  @Prop({ default: {} })
  private filterParams!: any;
  // 外部参数
  @Prop({ default: {} })
  private outParams!: any;
  // 是否展示新增按钮
  @Prop() private addBtn!: boolean;
  // 是否展示导出按钮
  @Prop() private exportBtn!: boolean;
  // 表格参数
  @Prop() private tableList!: tableList[];
  // 请求数据地址
  @Prop() private url!: string;
  // 请求数据类型
  @Prop({ default: 'formData' })
  private dataType!: string;
  // 表格行ID
  @Prop() private rowKey!: string;
  // 操作参数
  @Prop() private opreat!: Opreat[];
  // 操作栏width
  @Prop() private opreatWidth!: string;
  // 本地存储字段名
  @Prop() private localName!: string;
  // 请求错误回调事件
  @Prop() private fetchError!: string;
  // 默认分页数量
  @Prop() private defaultPageSize!: number;
  // 数据返回格式
  @Prop() private BackParams!: object;
  // 请求数据方法
  @Prop() private fetchType!: string;

  @Prop({ default: false }) private highlightCurrentRow!: boolean;
  // 初始化请求参数
  tableParams: any = Object.assign(this.filterParams, this.outParams);

  created() {
    console.log(this.tableList);
    // window.localStorage.setItem()
  }

  reloadTable() {
    const table: any = this.$refs.MTable;
    // 延迟100ms加载数据
    setTimeout(() => {
      table.reload();
    }, 100);
  }

  @Emit()
  searchFun(params: any) {
    this.tableParams = params;
    const table: any = this.$refs.MTable;

    table.clearPageParams();
    // 延迟100ms加载数据
    setTimeout(() => {
      table.reload();
    }, 100);
  }
  @Emit()
  clearFun() {
    this.$emit('clearOutParams');
  }

  @Emit()
  addBack() {
    this.$emit('addBack');
  }
  @Emit()
  tableHeight(params: any) {
    const table: any = this.$refs.MTable;
    table.$el.style.marginTop = `${params - 48}px`;
  }
  @Emit()
  exportBack() {
    this.$emit('exportBack');
  }
  @Emit()
  setTable(list: Array<string>) {
    // this.tableList=list;
    console.log(list);
    console.log(this.tableList);
  }
  @Emit()
  tableClick(key: string, row: any) {
    this.$emit('menuClick', key, row);
  }
  @Emit()
  selectChange(val: any) {
    this.$emit('selectChange', val);
  }
  @Emit()
  currentChange(val: any) {
    this.$emit('currentChange', val);
  }
}
</script>

<style lang="less" scoped>
.filter-table {
  overflow: hidden;
  min-height: e("calc(100vh - 100px)");
}
</style>

